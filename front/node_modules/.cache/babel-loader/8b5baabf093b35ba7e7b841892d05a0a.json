{"ast":null,"code":"/**\r\n * DevExtreme (esm/ui/grid_core/ui.grid_core.state_storing.js)\r\n * Version: 21.2.3\r\n * Build date: Thu Oct 28 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\nimport { getKeyHash, equalByValue } from \"../../core/utils/common\";\nimport { isDefined } from \"../../core/utils/type\";\nimport { extend } from \"../../core/utils/extend\";\nimport { StateStoringController } from \"./ui.grid_core.state_storing_core\";\nimport { Deferred } from \"../../core/utils/deferred\";\n\nvar getDataState = that => {\n  var pagerView = that.getView(\"pagerView\");\n  var dataController = that.getController(\"data\");\n  var state = {\n    allowedPageSizes: pagerView ? pagerView.getPageSizes() : void 0,\n    filterPanel: {\n      filterEnabled: that.option(\"filterPanel.filterEnabled\")\n    },\n    filterValue: that.option(\"filterValue\"),\n    focusedRowKey: that.option(\"focusedRowEnabled\") ? that.option(\"focusedRowKey\") : void 0\n  };\n  return extend(state, dataController.getUserState());\n};\n\nvar processLoadState = that => {\n  var columnsController = that.getController(\"columns\");\n  var selectionController = that.getController(\"selection\");\n  var exportController = that.getController(\"export\");\n  var dataController = that.getController(\"data\");\n\n  if (columnsController) {\n    columnsController.columnsChanged.add(function () {\n      that.updateState({\n        columns: columnsController.getUserState()\n      });\n    });\n  }\n\n  if (selectionController) {\n    selectionController.selectionChanged.add(function (e) {\n      that.updateState({\n        selectedRowKeys: e.selectedRowKeys,\n        selectionFilter: e.selectionFilter\n      });\n    });\n  }\n\n  if (dataController) {\n    that._initialPageSize = that.option(\"paging.pageSize\");\n    that._initialFilterValue = that.option(\"filterValue\");\n    dataController.changed.add(function () {\n      var state = getDataState(that);\n      that.updateState(state);\n    });\n  }\n\n  if (exportController) {\n    exportController.selectionOnlyChanged.add(function () {\n      that.updateState({\n        exportSelectionOnly: exportController.selectionOnly()\n      });\n    });\n  }\n};\n\nvar DEFAULT_FILTER_VALUE = null;\n\nvar getFilterValue = (that, state) => {\n  var filterSyncController = that.getController(\"filterSync\");\n  var columnsController = that.getController(\"columns\");\n  var hasFilterState = state.columns || void 0 !== state.filterValue;\n\n  if (filterSyncController) {\n    if (hasFilterState) {\n      return state.filterValue || filterSyncController.getFilterValueFromColumns(state.columns);\n    } else {\n      return that._initialFilterValue || filterSyncController.getFilterValueFromColumns(columnsController.getColumns());\n    }\n  }\n\n  return DEFAULT_FILTER_VALUE;\n};\n\nexport var stateStoringModule = {\n  defaultOptions: function () {\n    return {\n      stateStoring: {\n        enabled: false,\n        storageKey: null,\n        type: \"localStorage\",\n        customLoad: null,\n        customSave: null,\n        savingTimeout: 2e3\n      }\n    };\n  },\n  controllers: {\n    stateStoring: StateStoringController\n  },\n  extenders: {\n    views: {\n      rowsView: {\n        init: function () {\n          var that = this;\n          var dataController = that.getController(\"data\");\n          that.callBase();\n          dataController.stateLoaded.add(function () {\n            if (dataController.isLoaded() && !dataController.getDataSource()) {\n              that.setLoading(false);\n              that.renderNoDataText();\n              var columnHeadersView = that.component.getView(\"columnHeadersView\");\n              columnHeadersView && columnHeadersView.render();\n\n              that.component._fireContentReadyAction();\n            }\n          });\n        }\n      }\n    },\n    controllers: {\n      stateStoring: {\n        init: function () {\n          this.callBase.apply(this, arguments);\n          processLoadState(this);\n        },\n        isLoading: function () {\n          return this.callBase() || this.getController(\"data\").isStateLoading();\n        },\n        state: function (_state) {\n          var result = this.callBase.apply(this, arguments);\n\n          if (void 0 !== _state) {\n            this.applyState(extend({}, _state));\n          }\n\n          return result;\n        },\n        updateState: function (state) {\n          if (this.isEnabled()) {\n            var oldState = this.state();\n            var newState = extend({}, oldState, state);\n            var oldStateHash = getKeyHash(oldState);\n            var newStateHash = getKeyHash(newState);\n\n            if (!equalByValue(oldStateHash, newStateHash)) {\n              extend(this._state, state);\n              this.save();\n            }\n          } else {\n            extend(this._state, state);\n          }\n        },\n        applyState: function (state) {\n          var allowedPageSizes = state.allowedPageSizes;\n          var searchText = state.searchText;\n          var selectedRowKeys = state.selectedRowKeys;\n          var selectionFilter = state.selectionFilter;\n          var exportController = this.getController(\"export\");\n          var columnsController = this.getController(\"columns\");\n          var dataController = this.getController(\"data\");\n          var scrollingMode = this.option(\"scrolling.mode\");\n          var isVirtualScrollingMode = \"virtual\" === scrollingMode || \"infinite\" === scrollingMode;\n          var showPageSizeSelector = true === this.option(\"pager.visible\") && this.option(\"pager.showPageSizeSelector\");\n          this.component.beginUpdate();\n\n          if (columnsController) {\n            columnsController.setUserState(state.columns);\n          }\n\n          if (exportController) {\n            exportController.selectionOnly(state.exportSelectionOnly);\n          }\n\n          if (selectedRowKeys) {\n            this.option(\"selectedRowKeys\", selectedRowKeys);\n          }\n\n          this.option(\"selectionFilter\", selectionFilter);\n\n          if (allowedPageSizes && \"auto\" === this.option(\"pager.allowedPageSizes\")) {\n            this.option(\"pager\").allowedPageSizes = allowedPageSizes;\n          }\n\n          if (this.option(\"focusedRowEnabled\") && void 0 !== state.focusedRowKey) {\n            this.option(\"focusedRowIndex\", -1);\n            this.option(\"focusedRowKey\", state.focusedRowKey);\n          }\n\n          this.component.endUpdate();\n          searchText && this.option(\"searchPanel.text\", searchText);\n          this.option(\"filterValue\", getFilterValue(this, state));\n          this.option(\"filterPanel.filterEnabled\", state.filterPanel ? state.filterPanel.filterEnabled : true);\n          this.option(\"paging.pageIndex\", state.pageIndex || 0);\n          this.option(\"paging.pageSize\", (!isVirtualScrollingMode || showPageSizeSelector) && isDefined(state.pageSize) ? state.pageSize : this._initialPageSize);\n          dataController && dataController.reset();\n        }\n      },\n      columns: {\n        getVisibleColumns: function () {\n          var visibleColumns = this.callBase.apply(this, arguments);\n          var stateStoringController = this.getController(\"stateStoring\");\n          return stateStoringController.isEnabled() && !stateStoringController.isLoaded() ? [] : visibleColumns;\n        }\n      },\n      data: {\n        callbackNames: function () {\n          return this.callBase().concat([\"stateLoaded\"]);\n        },\n        _refreshDataSource: function () {\n          var callBase = this.callBase;\n          var stateStoringController = this.getController(\"stateStoring\");\n\n          if (stateStoringController.isEnabled() && !stateStoringController.isLoaded()) {\n            clearTimeout(this._restoreStateTimeoutID);\n            var deferred = new Deferred();\n            this._restoreStateTimeoutID = setTimeout(() => {\n              stateStoringController.load().always(() => {\n                this._restoreStateTimeoutID = null;\n              }).done(() => {\n                callBase.call(this);\n                this.stateLoaded.fire();\n                deferred.resolve();\n              }).fail(error => {\n                this.stateLoaded.fire();\n\n                this._handleLoadError(error || \"Unknown error\");\n\n                deferred.reject();\n              });\n            });\n            return deferred.promise();\n          } else if (!this.isStateLoading()) {\n            callBase.call(this);\n          }\n        },\n        isLoading: function () {\n          var stateStoringController = this.getController(\"stateStoring\");\n          return this.callBase() || stateStoringController.isLoading();\n        },\n        isStateLoading: function () {\n          return isDefined(this._restoreStateTimeoutID);\n        },\n        isLoaded: function () {\n          return this.callBase() && !this.isStateLoading();\n        },\n        dispose: function () {\n          clearTimeout(this._restoreStateTimeoutID);\n          this.callBase();\n        }\n      },\n      selection: {\n        _fireSelectionChanged: function (options) {\n          var stateStoringController = this.getController(\"stateStoring\");\n          var isDeferredSelection = this.option(\"selection.deferred\");\n\n          if (stateStoringController.isLoading() && isDeferredSelection) {\n            return;\n          }\n\n          this.callBase.apply(this, arguments);\n        }\n      }\n    }\n  }\n};","map":{"version":3,"sources":["/home/narminali/Desktop/vabiss/narmin-oms-front/node_modules/devextreme/esm/ui/grid_core/ui.grid_core.state_storing.js"],"names":["getKeyHash","equalByValue","isDefined","extend","StateStoringController","Deferred","getDataState","that","pagerView","getView","dataController","getController","state","allowedPageSizes","getPageSizes","filterPanel","filterEnabled","option","filterValue","focusedRowKey","getUserState","processLoadState","columnsController","selectionController","exportController","columnsChanged","add","updateState","columns","selectionChanged","e","selectedRowKeys","selectionFilter","_initialPageSize","_initialFilterValue","changed","selectionOnlyChanged","exportSelectionOnly","selectionOnly","DEFAULT_FILTER_VALUE","getFilterValue","filterSyncController","hasFilterState","getFilterValueFromColumns","getColumns","stateStoringModule","defaultOptions","stateStoring","enabled","storageKey","type","customLoad","customSave","savingTimeout","controllers","extenders","views","rowsView","init","callBase","stateLoaded","isLoaded","getDataSource","setLoading","renderNoDataText","columnHeadersView","component","render","_fireContentReadyAction","apply","arguments","isLoading","isStateLoading","_state","result","applyState","isEnabled","oldState","newState","oldStateHash","newStateHash","save","searchText","scrollingMode","isVirtualScrollingMode","showPageSizeSelector","beginUpdate","setUserState","endUpdate","pageIndex","pageSize","reset","getVisibleColumns","visibleColumns","stateStoringController","data","callbackNames","concat","_refreshDataSource","clearTimeout","_restoreStateTimeoutID","deferred","setTimeout","load","always","done","call","fire","resolve","fail","error","_handleLoadError","reject","promise","dispose","selection","_fireSelectionChanged","options","isDeferredSelection"],"mappings":"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","sourcesContent":["/**\r\n * DevExtreme (esm/ui/grid_core/ui.grid_core.state_storing.js)\r\n * Version: 21.2.3\r\n * Build date: Thu Oct 28 2021\r\n *\r\n * Copyright (c) 2012 - 2021 Developer Express Inc. ALL RIGHTS RESERVED\r\n * Read about DevExtreme licensing here: https://js.devexpress.com/Licensing/\r\n */\r\nimport {\r\n    getKeyHash,\r\n    equalByValue\r\n} from \"../../core/utils/common\";\r\nimport {\r\n    isDefined\r\n} from \"../../core/utils/type\";\r\nimport {\r\n    extend\r\n} from \"../../core/utils/extend\";\r\nimport {\r\n    StateStoringController\r\n} from \"./ui.grid_core.state_storing_core\";\r\nimport {\r\n    Deferred\r\n} from \"../../core/utils/deferred\";\r\nvar getDataState = that => {\r\n    var pagerView = that.getView(\"pagerView\");\r\n    var dataController = that.getController(\"data\");\r\n    var state = {\r\n        allowedPageSizes: pagerView ? pagerView.getPageSizes() : void 0,\r\n        filterPanel: {\r\n            filterEnabled: that.option(\"filterPanel.filterEnabled\")\r\n        },\r\n        filterValue: that.option(\"filterValue\"),\r\n        focusedRowKey: that.option(\"focusedRowEnabled\") ? that.option(\"focusedRowKey\") : void 0\r\n    };\r\n    return extend(state, dataController.getUserState())\r\n};\r\nvar processLoadState = that => {\r\n    var columnsController = that.getController(\"columns\");\r\n    var selectionController = that.getController(\"selection\");\r\n    var exportController = that.getController(\"export\");\r\n    var dataController = that.getController(\"data\");\r\n    if (columnsController) {\r\n        columnsController.columnsChanged.add((function() {\r\n            that.updateState({\r\n                columns: columnsController.getUserState()\r\n            })\r\n        }))\r\n    }\r\n    if (selectionController) {\r\n        selectionController.selectionChanged.add((function(e) {\r\n            that.updateState({\r\n                selectedRowKeys: e.selectedRowKeys,\r\n                selectionFilter: e.selectionFilter\r\n            })\r\n        }))\r\n    }\r\n    if (dataController) {\r\n        that._initialPageSize = that.option(\"paging.pageSize\");\r\n        that._initialFilterValue = that.option(\"filterValue\");\r\n        dataController.changed.add((function() {\r\n            var state = getDataState(that);\r\n            that.updateState(state)\r\n        }))\r\n    }\r\n    if (exportController) {\r\n        exportController.selectionOnlyChanged.add((function() {\r\n            that.updateState({\r\n                exportSelectionOnly: exportController.selectionOnly()\r\n            })\r\n        }))\r\n    }\r\n};\r\nvar DEFAULT_FILTER_VALUE = null;\r\nvar getFilterValue = (that, state) => {\r\n    var filterSyncController = that.getController(\"filterSync\");\r\n    var columnsController = that.getController(\"columns\");\r\n    var hasFilterState = state.columns || void 0 !== state.filterValue;\r\n    if (filterSyncController) {\r\n        if (hasFilterState) {\r\n            return state.filterValue || filterSyncController.getFilterValueFromColumns(state.columns)\r\n        } else {\r\n            return that._initialFilterValue || filterSyncController.getFilterValueFromColumns(columnsController.getColumns())\r\n        }\r\n    }\r\n    return DEFAULT_FILTER_VALUE\r\n};\r\nexport var stateStoringModule = {\r\n    defaultOptions: function() {\r\n        return {\r\n            stateStoring: {\r\n                enabled: false,\r\n                storageKey: null,\r\n                type: \"localStorage\",\r\n                customLoad: null,\r\n                customSave: null,\r\n                savingTimeout: 2e3\r\n            }\r\n        }\r\n    },\r\n    controllers: {\r\n        stateStoring: StateStoringController\r\n    },\r\n    extenders: {\r\n        views: {\r\n            rowsView: {\r\n                init: function() {\r\n                    var that = this;\r\n                    var dataController = that.getController(\"data\");\r\n                    that.callBase();\r\n                    dataController.stateLoaded.add((function() {\r\n                        if (dataController.isLoaded() && !dataController.getDataSource()) {\r\n                            that.setLoading(false);\r\n                            that.renderNoDataText();\r\n                            var columnHeadersView = that.component.getView(\"columnHeadersView\");\r\n                            columnHeadersView && columnHeadersView.render();\r\n                            that.component._fireContentReadyAction()\r\n                        }\r\n                    }))\r\n                }\r\n            }\r\n        },\r\n        controllers: {\r\n            stateStoring: {\r\n                init: function() {\r\n                    this.callBase.apply(this, arguments);\r\n                    processLoadState(this)\r\n                },\r\n                isLoading: function() {\r\n                    return this.callBase() || this.getController(\"data\").isStateLoading()\r\n                },\r\n                state: function(_state) {\r\n                    var result = this.callBase.apply(this, arguments);\r\n                    if (void 0 !== _state) {\r\n                        this.applyState(extend({}, _state))\r\n                    }\r\n                    return result\r\n                },\r\n                updateState: function(state) {\r\n                    if (this.isEnabled()) {\r\n                        var oldState = this.state();\r\n                        var newState = extend({}, oldState, state);\r\n                        var oldStateHash = getKeyHash(oldState);\r\n                        var newStateHash = getKeyHash(newState);\r\n                        if (!equalByValue(oldStateHash, newStateHash)) {\r\n                            extend(this._state, state);\r\n                            this.save()\r\n                        }\r\n                    } else {\r\n                        extend(this._state, state)\r\n                    }\r\n                },\r\n                applyState: function(state) {\r\n                    var allowedPageSizes = state.allowedPageSizes;\r\n                    var searchText = state.searchText;\r\n                    var selectedRowKeys = state.selectedRowKeys;\r\n                    var selectionFilter = state.selectionFilter;\r\n                    var exportController = this.getController(\"export\");\r\n                    var columnsController = this.getController(\"columns\");\r\n                    var dataController = this.getController(\"data\");\r\n                    var scrollingMode = this.option(\"scrolling.mode\");\r\n                    var isVirtualScrollingMode = \"virtual\" === scrollingMode || \"infinite\" === scrollingMode;\r\n                    var showPageSizeSelector = true === this.option(\"pager.visible\") && this.option(\"pager.showPageSizeSelector\");\r\n                    this.component.beginUpdate();\r\n                    if (columnsController) {\r\n                        columnsController.setUserState(state.columns)\r\n                    }\r\n                    if (exportController) {\r\n                        exportController.selectionOnly(state.exportSelectionOnly)\r\n                    }\r\n                    if (selectedRowKeys) {\r\n                        this.option(\"selectedRowKeys\", selectedRowKeys)\r\n                    }\r\n                    this.option(\"selectionFilter\", selectionFilter);\r\n                    if (allowedPageSizes && \"auto\" === this.option(\"pager.allowedPageSizes\")) {\r\n                        this.option(\"pager\").allowedPageSizes = allowedPageSizes\r\n                    }\r\n                    if (this.option(\"focusedRowEnabled\") && void 0 !== state.focusedRowKey) {\r\n                        this.option(\"focusedRowIndex\", -1);\r\n                        this.option(\"focusedRowKey\", state.focusedRowKey)\r\n                    }\r\n                    this.component.endUpdate();\r\n                    searchText && this.option(\"searchPanel.text\", searchText);\r\n                    this.option(\"filterValue\", getFilterValue(this, state));\r\n                    this.option(\"filterPanel.filterEnabled\", state.filterPanel ? state.filterPanel.filterEnabled : true);\r\n                    this.option(\"paging.pageIndex\", state.pageIndex || 0);\r\n                    this.option(\"paging.pageSize\", (!isVirtualScrollingMode || showPageSizeSelector) && isDefined(state.pageSize) ? state.pageSize : this._initialPageSize);\r\n                    dataController && dataController.reset()\r\n                }\r\n            },\r\n            columns: {\r\n                getVisibleColumns: function() {\r\n                    var visibleColumns = this.callBase.apply(this, arguments);\r\n                    var stateStoringController = this.getController(\"stateStoring\");\r\n                    return stateStoringController.isEnabled() && !stateStoringController.isLoaded() ? [] : visibleColumns\r\n                }\r\n            },\r\n            data: {\r\n                callbackNames: function() {\r\n                    return this.callBase().concat([\"stateLoaded\"])\r\n                },\r\n                _refreshDataSource: function() {\r\n                    var callBase = this.callBase;\r\n                    var stateStoringController = this.getController(\"stateStoring\");\r\n                    if (stateStoringController.isEnabled() && !stateStoringController.isLoaded()) {\r\n                        clearTimeout(this._restoreStateTimeoutID);\r\n                        var deferred = new Deferred;\r\n                        this._restoreStateTimeoutID = setTimeout(() => {\r\n                            stateStoringController.load().always(() => {\r\n                                this._restoreStateTimeoutID = null\r\n                            }).done(() => {\r\n                                callBase.call(this);\r\n                                this.stateLoaded.fire();\r\n                                deferred.resolve()\r\n                            }).fail(error => {\r\n                                this.stateLoaded.fire();\r\n                                this._handleLoadError(error || \"Unknown error\");\r\n                                deferred.reject()\r\n                            })\r\n                        });\r\n                        return deferred.promise()\r\n                    } else if (!this.isStateLoading()) {\r\n                        callBase.call(this)\r\n                    }\r\n                },\r\n                isLoading: function() {\r\n                    var stateStoringController = this.getController(\"stateStoring\");\r\n                    return this.callBase() || stateStoringController.isLoading()\r\n                },\r\n                isStateLoading: function() {\r\n                    return isDefined(this._restoreStateTimeoutID)\r\n                },\r\n                isLoaded: function() {\r\n                    return this.callBase() && !this.isStateLoading()\r\n                },\r\n                dispose: function() {\r\n                    clearTimeout(this._restoreStateTimeoutID);\r\n                    this.callBase()\r\n                }\r\n            },\r\n            selection: {\r\n                _fireSelectionChanged: function(options) {\r\n                    var stateStoringController = this.getController(\"stateStoring\");\r\n                    var isDeferredSelection = this.option(\"selection.deferred\");\r\n                    if (stateStoringController.isLoading() && isDeferredSelection) {\r\n                        return\r\n                    }\r\n                    this.callBase.apply(this, arguments)\r\n                }\r\n            }\r\n        }\r\n    }\r\n};\r\n"]},"metadata":{},"sourceType":"module"}